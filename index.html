<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock King - S&P 500 Analysis</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Orbitron', 'Arial Black', sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #0a0a0a 100%);
            color: #ffffff;
            min-height: 100vh;
            font-weight: 900;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(0, 255, 0, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 0, 0, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(0, 150, 255, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
            animation: colorShift 10s ease-in-out infinite;
        }
        
        @keyframes colorShift {
            0%, 100% { 
                background: 
                    radial-gradient(circle at 20% 80%, rgba(0, 255, 0, 0.08) 0%, transparent 50%),
                    radial-gradient(circle at 80% 20%, rgba(255, 0, 0, 0.08) 0%, transparent 50%),
                    radial-gradient(circle at 50% 50%, rgba(0, 150, 255, 0.05) 0%, transparent 50%);
            }
            33% { 
                background: 
                    radial-gradient(circle at 80% 20%, rgba(0, 255, 0, 0.08) 0%, transparent 50%),
                    radial-gradient(circle at 50% 80%, rgba(255, 0, 0, 0.08) 0%, transparent 50%),
                    radial-gradient(circle at 20% 50%, rgba(0, 150, 255, 0.05) 0%, transparent 50%);
            }
            66% { 
                background: 
                    radial-gradient(circle at 50% 20%, rgba(0, 255, 0, 0.08) 0%, transparent 50%),
                    radial-gradient(circle at 20% 50%, rgba(255, 0, 0, 0.08) 0%, transparent 50%),
                    radial-gradient(circle at 80% 80%, rgba(0, 150, 255, 0.05) 0%, transparent 50%);
            }
        }
        
        /* Start Screen Styles */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #0a0a0a 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            text-align: center;
        }
        
        .start-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .logo-icon {
            font-size: 0.8em;
            font-weight: 900;
            color: #00ff00;
            background: linear-gradient(135deg, #00ff00, #00cc00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
            padding: 8px 12px;
            border: 2px solid #00ff00;
            border-radius: 8px;
            margin-right: 10px;
        }
        
        .start-subtitle {
            font-size: 1.5em;
            color: #cccccc;
            margin-bottom: 20px;
            font-family: 'Orbitron', 'Arial Black', sans-serif;
        }
        
        .start-motto {
            font-size: 1.1em;
            color: #00ff00;
            margin-bottom: 40px;
            font-family: 'Orbitron', 'Arial Black', sans-serif;
            font-style: italic;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }
        
        .start-button {
            background: linear-gradient(135deg, #00ff00 0%, #00cc00 100%);
            color: #000;
            padding: 20px 40px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 900;
            font-family: 'Orbitron', 'Arial Black', sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 255, 0, 0.3);
        }
        
        .start-button:hover {
            background: linear-gradient(135deg, #00cc00 0%, #00aa00 100%);
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 255, 0, 0.4);
        }
        
        .main-content {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }
        
        .main-content.visible {
            display: block;
            opacity: 1;
            transform: translateY(0);
            animation: fadeInUp 0.6s ease;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .header {
            text-align: center;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: #ffffff;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header h1 {
            font-size: 3em;
            margin: 0;
            font-weight: 900;
            font-family: 'Orbitron', 'Arial Black', sans-serif;
            color: #ffffff;
        }
        
        .header p {
            font-size: 1.2em;
            margin: 10px 0 0 0;
            font-weight: 400;
            color: #cccccc;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.08);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                0 4px 16px rgba(255, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 12px 40px rgba(0, 0, 0, 0.4),
                0 6px 20px rgba(255, 255, 255, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        .card h3 {
            margin-top: 0;
            color: #ffffff;
            font-size: 1.4em;
            font-weight: 900;
            font-family: 'Orbitron', 'Arial Black', sans-serif;
        }
        
        .search-box {
            width: 100%;
            padding: 18px 20px;
            font-size: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.6);
            color: #ffffff;
            font-weight: bold;
            font-family: 'Orbitron', 'Arial Black', sans-serif;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .search-box:focus {
            outline: none;
            border-color: #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
            background: rgba(0, 0, 0, 0.8);
        }
        
        .search-box::placeholder {
            color: rgba(255, 255, 255, 0.6);
            font-family: 'Orbitron', 'Arial Black', sans-serif;
        }
        
        .btn {
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            color: #000;
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 8px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            font-family: 'Orbitron', 'Arial Black', sans-serif;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .chart-container {
            height: 500px;
            margin: 20px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }
        
        .prediction {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            font-weight: 900;
            font-size: 1.2em;
            position: relative;
            overflow: hidden;
        }
        
        .buy { 
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.3) 0%, rgba(0, 200, 0, 0.3) 100%);
            color: #00ff00;
            border: 3px solid #00ff00;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.5);
        }
        
        .sell { 
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.3) 0%, rgba(200, 0, 0, 0.3) 100%);
            color: #ff0000;
            border: 3px solid #ff0000;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
        }
        
        .hold { 
            background: linear-gradient(135deg, rgba(255, 255, 0, 0.3) 0%, rgba(200, 200, 0, 0.3) 100%);
            color: #ffff00;
            border: 3px solid #ffff00;
            box-shadow: 0 0 30px rgba(255, 255, 0, 0.5);
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #00ff00;
            font-size: 1.2em;
            position: relative;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #00ff00;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.2) 0%, rgba(200, 0, 0, 0.2) 100%);
            color: #ff0000;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border: 1px solid #ff0000;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 255, 0, 0.3);
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: #cccccc;
            font-weight: 400;
        }
        
        .metric-value {
            color: #00ff00;
            font-weight: 900;
        }
        
        .time-periods {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .time-period-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Orbitron', 'Arial Black', sans-serif;
            font-weight: bold;
        }
        
        .time-period-btn:hover {
            background: rgba(0, 255, 0, 0.2);
            border-color: #00ff00;
        }
        
        .time-period-btn.active {
            background: rgba(0, 255, 0, 0.3);
            border-color: #00ff00;
            color: #00ff00;
        }
        
        .disclaimer {
            text-align: center;
            color: #888;
            font-size: 0.9em;
            margin-top: 30px;
            padding: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stock-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .stock-item {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Orbitron', 'Arial Black', sans-serif;
            font-weight: bold;
            color: #ffffff;
            text-align: center;
        }
        
        .stock-item:hover {
            background: rgba(0, 255, 0, 0.1);
            border-color: rgba(0, 255, 0, 0.3);
            transform: translateY(-2px);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .time-periods {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Start Screen -->
    <div class="start-screen" id="startScreen">
        <div class="start-logo">
            <div class="logo-icon">SK</div>
            STOCK KING
        </div>
        <div class="start-subtitle">S&P 500 Analysis & Trading Signals</div>
        <div class="start-motto">From newbie to veteran: Investing insights made easy.</div>
        <button class="start-button" onclick="startApp()">START TRADING</button>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="header">
            <h1>STOCK KING</h1>
            <p>S&P 500 Analysis & Trading Signals</p>
        </div>

    <div class="container">
        <div class="card">
            <h3>SEARCH S&P 500 STOCK</h3>
            <input type="text" id="searchInput" class="search-box" placeholder="Type S&P 500 ticker symbol (e.g., AAPL, MSFT, GOOGL)">
            <button class="btn" onclick="searchStock()">ANALYZE S&P 500 STOCK</button>
            
            <div class="stock-list">
                <div class="stock-item" onclick="searchStock('AAPL')">AAPL - Apple</div>
                <div class="stock-item" onclick="searchStock('MSFT')">MSFT - Microsoft</div>
                <div class="stock-item" onclick="searchStock('GOOGL')">GOOGL - Google</div>
                <div class="stock-item" onclick="searchStock('AMZN')">AMZN - Amazon</div>
                <div class="stock-item" onclick="searchStock('TSLA')">TSLA - Tesla</div>
                <div class="stock-item" onclick="searchStock('META')">META - Meta</div>
                <div class="stock-item" onclick="searchStock('NVDA')">NVDA - NVIDIA</div>
                <div class="stock-item" onclick="searchStock('JPM')">JPM - JPMorgan</div>
                <div class="stock-item" onclick="searchStock('JNJ')">JNJ - Johnson & Johnson</div>
                <div class="stock-item" onclick="searchStock('V')">V - Visa</div>
            </div>
        </div>
        
        <div class="card">
            <h3>INVESTMENT SIGNAL</h3>
            <div id="prediction" class="prediction">
                <div class="signal-text">Select a stock to analyze</div>
                <div class="confidence-level"></div>
                <div class="signal-recap"></div>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>PRICE CHART</h3>
        <div class="time-periods">
            <button class="time-period-btn active" data-period="all">ALL TIME</button>
            <button class="time-period-btn" data-period="1y">1 YEAR</button>
            <button class="time-period-btn" data-period="3m">3 MONTHS</button>
            <button class="time-period-btn" data-period="1m">1 MONTH</button>
            <button class="time-period-btn" data-period="5d">5 DAYS</button>
            <button class="time-period-btn" data-period="1d">1 DAY</button>
        </div>
        <div id="chart" class="chart-container"></div>
    </div>

    <div class="card">
        <h3>QUANTITATIVE ANALYSIS</h3>
        <div id="analysis"></div>
    </div>

    <div class="card">
        <h3>ANALYSIS EXPLANATIONS</h3>
        <div id="explanations" style="color: #cccccc; line-height: 1.6;">
            <div style="margin-bottom: 20px;">
                <h4 style="color: #00ff00; margin-bottom: 10px;">RSI (Relative Strength Index)</h4>
                <p>Measures momentum on a scale of 0-100. Values above 70 indicate overbought conditions (potential sell signal), while values below 30 indicate oversold conditions (potential buy signal). Values between 30-70 are considered neutral.</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <h4 style="color: #00ff00; margin-bottom: 10px;">Volatility</h4>
                <p>Shows how much the stock price fluctuates. High volatility (>30%) means the stock is risky but potentially profitable. Low volatility (<15%) means the stock is stable but may have limited growth potential.</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <h4 style="color: #00ff00; margin-bottom: 10px;">Volume Ratio</h4>
                <p>Compares current trading volume to average volume. Values above 1.5x indicate high activity (strong interest), while values below 0.5x indicate low activity (weak interest). High volume often confirms price movements.</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <h4 style="color: #00ff00; margin-bottom: 10px;">Moving Averages (MA20, MA50)</h4>
                <p>Shows average price over 20 or 50 days. When current price is above the moving average, it indicates an upward trend. When below, it indicates a downward trend. The percentage shows how far above/below the average the current price is.</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <h4 style="color: #00ff00; margin-bottom: 10px;">Period Changes</h4>
                <p>Shows price change over 20 or 50 days. Positive values indicate the stock has gained value over that period, while negative values indicate losses. This helps identify longer-term trends beyond daily fluctuations.</p>
            </div>
            
            <div>
                <h4 style="color: #00ff00; margin-bottom: 10px;">Investment Signal Logic</h4>
                <p>Our signals combine multiple technical indicators: RSI levels, price momentum, moving average positions, and volume activity. Strong buy signals occur when a stock is oversold (RSI < 30) with positive momentum. Strong sell signals occur when overbought (RSI > 70) with negative momentum. Hold signals indicate mixed or neutral conditions requiring more data.</p>
            </div>
            
            <div style="margin-top: 30px; padding: 20px; background: rgba(0, 255, 0, 0.1); border-radius: 10px; border: 1px solid rgba(0, 255, 0, 0.3);">
                <h4 style="color: #00ff00; margin-bottom: 15px; text-align: center;">RECOMMENDATION RATIONALE</h4>
                
                <div style="text-align: center; padding: 20px; background: rgba(0, 0, 0, 0.3); border-radius: 8px;">
                    <h5 style="color: #ffffff; margin-bottom: 15px;">WHY THIS RECOMMENDATION WAS MADE</h5>
                    <p style="font-size: 1.1em; color: #cccccc; line-height: 1.6;">The recommendation above is generated by analyzing multiple technical indicators in combination. The RSI shows whether the stock is overbought or oversold, the moving averages indicate trend direction, volume analysis reveals market interest, and price momentum shows the strength of recent movements. When these indicators align in a particular direction, it creates a stronger signal. The confidence level reflects how many indicators are pointing in the same direction and the strength of their signals.</p>
                </div>
            </div>
        </div>
    </div>

        <div class="disclaimer">
            This is not official financial advice
        </div>
    </div>

    <script>
        // Real stock data using Alpha Vantage API (free tier)
        const API_KEY = 'demo'; // You can get a free key from alphavantage.co
        let currentTicker = null;
        let currentData = null;
        let currentPeriod = 'all';

        function startApp() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('mainContent').classList.add('visible');
        }

        async function searchStock(ticker = null) {
            if (!ticker) {
                ticker = document.getElementById('searchInput').value.toUpperCase();
            }
            
            if (!ticker) {
                alert('Please enter a ticker symbol');
                return;
            }
            
            // Update search input
            document.getElementById('searchInput').value = ticker;
            
            // Show loading
            document.getElementById('prediction').innerHTML = '<div class="loading">Analyzing stock...</div>';
            document.getElementById('analysis').innerHTML = '<div class="loading">Loading analysis...</div>';
            
            try {
                // Try to get real data from Alpha Vantage
                const data = await fetchRealStockData(ticker);
                if (data) {
                    displayRealAnalysis(data, ticker);
                } else {
                    throw new Error('No real data available');
                }
            } catch (error) {
                console.log('Using demo data for', ticker);
                displayDemoAnalysis(ticker);
            }
        }

        async function fetchRealStockData(ticker) {
            try {
                // Get the correct range based on current period
                let range = '1y';
                let interval = '1d';
                
                switch(currentPeriod) {
                    case '1d':
                        range = '1d';
                        interval = '5m';
                        break;
                    case '5d':
                        range = '5d';
                        interval = '1h';
                        break;
                    case '1m':
                        range = '1mo';
                        interval = '1d';
                        break;
                    case '3m':
                        range = '3mo';
                        interval = '1d';
                        break;
                    case '1y':
                        range = '1y';
                        interval = '1d';
                        break;
                    case 'all':
                        range = 'max';
                        interval = '1d';
                        break;
                }
                
                const response = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?interval=${interval}&range=${range}`);
                if (!response.ok) {
                    throw new Error('API not available');
                }
                const data = await response.json();
                
                if (data.chart && data.chart.result && data.chart.result[0]) {
                    const result = data.chart.result[0];
                    const timestamps = result.timestamp;
                    const quotes = result.indicators.quote[0];
                    
                    // Filter out null values and get clean data
                    const validIndices = [];
                    for (let i = 0; i < timestamps.length; i++) {
                        if (quotes.close[i] !== null && quotes.close[i] !== undefined) {
                            validIndices.push(i);
                        }
                    }
                    
                    const dates = validIndices.map(i => new Date(timestamps[i] * 1000).toISOString().split('T')[0]);
                    const prices = validIndices.map(i => quotes.close[i]);
                    const volumes = validIndices.map(i => quotes.volume[i] || 0);
                    const opens = validIndices.map(i => quotes.open[i] || prices[i]);
                    const highs = validIndices.map(i => quotes.high[i] || prices[i]);
                    const lows = validIndices.map(i => quotes.low[i] || prices[i]);
                    
                    return {
                        ticker: ticker,
                        dates: dates,
                        prices: prices,
                        volumes: volumes,
                        opens: opens,
                        highs: highs,
                        lows: lows,
                        currentPrice: prices[prices.length - 1],
                        change: ((prices[prices.length - 1] - prices[0]) / prices[0] * 100).toFixed(2)
                    };
                }
                return null;
            } catch (error) {
                console.log('Real API failed, using demo data');
                return null;
            }
        }

        function displayRealAnalysis(data, ticker) {
            const prediction = document.getElementById('prediction');
            const analysis = document.getElementById('analysis');
            
            // Calculate real technical indicators
            const prices = data.prices;
            const volumes = data.volumes;
            const change = parseFloat(data.change);
            const currentPrice = data.currentPrice;
            
            // Calculate RSI
            const rsi = calculateRSI(prices);
            
            // Calculate volatility (standard deviation of returns)
            const volatility = calculateVolatility(prices);
            
            // Calculate volume ratio (current vs average)
            const avgVolume = volumes.reduce((a, b) => a + b, 0) / volumes.length;
            const volumeRatio = (volumes[volumes.length - 1] / avgVolume).toFixed(2);
            
            // Calculate moving averages
            const ma20 = calculateMA(prices, 20);
            const ma50 = calculateMA(prices, 50);
            const vsMA20 = ((currentPrice - ma20) / ma20 * 100).toFixed(1);
            const vsMA50 = ((currentPrice - ma50) / ma50 * 100).toFixed(1);
            
            // Calculate period changes
            const change20d = calculatePeriodChange(prices, 20);
            const change50d = calculatePeriodChange(prices, 50);
            
            // Generate signal based on real analysis
            let signal = 'HOLD';
            let confidence = '50%';
            let recap = 'Market conditions are neutral';
            
            if (rsi < 30 && change > 0) {
                signal = 'BUY';
                confidence = '80%';
                recap = 'Oversold with positive momentum - strong buy signal';
            } else if (rsi > 70 && change < 0) {
                signal = 'SELL';
                confidence = '75%';
                recap = 'Overbought with negative momentum - sell signal';
            } else if (change > 5 && vsMA20 > 0) {
                signal = 'BUY';
                confidence = '70%';
                recap = 'Strong upward trend above moving averages';
            } else if (change < -5 && vsMA20 < 0) {
                signal = 'SELL';
                confidence = '65%';
                recap = 'Strong downward trend below moving averages';
            } else if (change > 0 && rsi < 60) {
                signal = 'BUY';
                confidence = '60%';
                recap = 'Positive momentum with room to grow';
            } else if (change < 0 && rsi > 40) {
                signal = 'HOLD';
                confidence = '55%';
                recap = 'Mixed signals, wait for clearer direction';
            }
            
            // Update prediction
            prediction.innerHTML = `
                <div class="signal-text">${signal}</div>
                <div class="confidence-level">Confidence: ${confidence}</div>
                <div class="signal-recap">${recap}</div>
            `;
            prediction.className = `prediction ${signal.toLowerCase()}`;
            
            // Update analysis with real calculations
            analysis.innerHTML = `
                <div class="metric">
                    <span class="metric-label">Current Price:</span>
                    <span class="metric-value">$${currentPrice.toFixed(2)}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Period Change:</span>
                    <span class="metric-value">${change > 0 ? '+' : ''}${change}%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">RSI (14):</span>
                    <span class="metric-value">${rsi.toFixed(1)} ${rsi > 70 ? '(Overbought)' : rsi < 30 ? '(Oversold)' : ''}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Volatility:</span>
                    <span class="metric-value">${volatility.toFixed(1)}% ${volatility > 30 ? '(High)' : volatility < 15 ? '(Low)' : ''}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Volume Ratio:</span>
                    <span class="metric-value">${volumeRatio}x ${volumeRatio > 1.5 ? '(High Activity)' : volumeRatio < 0.5 ? '(Low Activity)' : ''}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">vs MA20:</span>
                    <span class="metric-value">${vsMA20 > 0 ? '+' : ''}${vsMA20}%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">vs MA50:</span>
                    <span class="metric-value">${vsMA50 > 0 ? '+' : ''}${vsMA50}%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">20d Change:</span>
                    <span class="metric-value">${change20d > 0 ? '+' : ''}${change20d.toFixed(1)}%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">50d Change:</span>
                    <span class="metric-value">${change50d > 0 ? '+' : ''}${change50d.toFixed(1)}%</span>
                </div>
            `;
            
            // Store data for chart
            currentData = {dates: data.dates, prices: data.prices, volumes: data.volumes};
            currentTicker = ticker;
            
            // Generate chart with real data
            updateChart(currentData, ticker);
        }

        function displayDemoAnalysis(ticker) {
            const analysis = document.getElementById('analysis');
            const prediction = document.getElementById('prediction');
            
            // Generate demo analysis
            const rsi = (Math.random() * 40 + 30).toFixed(1);
            const volatility = (Math.random() * 5 + 15).toFixed(1);
            const volumeRatio = (Math.random() * 2 + 0.5).toFixed(2);
            const change20d = (Math.random() * 20 - 10).toFixed(1);
            const change50d = (Math.random() * 30 - 15).toFixed(1);
            const vsMA20 = (Math.random() * 10 - 5).toFixed(1);
            const price = (Math.random() * 200 + 50).toFixed(2);
            const change = (Math.random() * 10 - 5).toFixed(2);
            
            const signal = Math.random() > 0.5 ? 'BUY' : Math.random() > 0.3 ? 'SELL' : 'HOLD';
            const confidence = (Math.random() * 30 + 60).toFixed(0);
            
            analysis.innerHTML = `
                <div class="metric">
                    <span class="metric-label">Current Price:</span>
                    <span class="metric-value">$${price}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Daily Change:</span>
                    <span class="metric-value">${change > 0 ? '+' : ''}${change}%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">RSI (14):</span>
                    <span class="metric-value">${rsi}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Volatility:</span>
                    <span class="metric-value">${volatility}%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Volume Ratio:</span>
                    <span class="metric-value">${volumeRatio}x</span>
                </div>
                <div class="metric">
                    <span class="metric-label">20d Change:</span>
                    <span class="metric-value">${change20d}%</span>
                </div>
            `;
            
            prediction.innerHTML = `
                <div class="signal-text">${signal}</div>
                <div class="confidence-level">Confidence: ${confidence}%</div>
                <div class="signal-recap">Based on technical analysis and market trends</div>
            `;
            
            prediction.className = `prediction ${signal.toLowerCase()}`;
            
            // Generate demo chart
            generateDemoChart(ticker);
        }

        function generateChart(ticker, data) {
            const dates = [];
            const prices = [];
            const volumes = [];
            
            // Generate data based on current period
            const daysToGenerate = getDaysForPeriod(currentPeriod);
            const basePrice = data.price;
            
            for (let i = daysToGenerate - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(date.toISOString().split('T')[0]);
                
                const change = (Math.random() - 0.5) * 10;
                prices.push(basePrice + change);
                
                volumes.push(Math.floor(Math.random() * 10000000 + 1000000));
            }
            
            currentData = {dates, prices, volumes};
            updateChart(currentData, ticker);
        }

        function generateDemoChart(ticker) {
            const dates = [];
            const prices = [];
            const volumes = [];
            
            // Generate data based on current period
            const daysToGenerate = getDaysForPeriod(currentPeriod);
            
            // Start with a realistic base price
            let basePrice = 150 + Math.random() * 100;
            
            for (let i = daysToGenerate - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(date.toISOString().split('T')[0]);
                
                // Create smoother, more realistic price movement
                const dailyChange = (Math.random() - 0.5) * 0.05; // Max 5% daily change
                basePrice = basePrice * (1 + dailyChange);
                prices.push(basePrice);
                
                // More realistic volume with some correlation to price movement
                const volumeBase = 2000000;
                const volumeVariation = Math.abs(dailyChange) * 10000000;
                volumes.push(Math.floor(volumeBase + volumeVariation + Math.random() * 1000000));
            }
            
            currentData = {dates, prices, volumes};
            updateChart(currentData, ticker);
        }

        function getDaysForPeriod(period) {
            switch(period) {
                case '1d': return 1;
                case '5d': return 5;
                case '1m': return 30;
                case '3m': return 90;
                case '1y': return 365;
                case 'all': return 365;
                default: return 30;
            }
        }

        function calculateRSI(prices, period = 14) {
            if (prices.length < period + 1) return 50;
            
            let gains = 0;
            let losses = 0;
            
            for (let i = 1; i <= period; i++) {
                const change = prices[i] - prices[i - 1];
                if (change > 0) gains += change;
                else losses -= change;
            }
            
            const avgGain = gains / period;
            const avgLoss = losses / period;
            
            if (avgLoss === 0) return 100;
            
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }

        function calculateVolatility(prices) {
            if (prices.length < 2) return 0;
            
            const returns = [];
            for (let i = 1; i < prices.length; i++) {
                returns.push((prices[i] - prices[i - 1]) / prices[i - 1]);
            }
            
            const mean = returns.reduce((a, b) => a + b, 0) / returns.length;
            const variance = returns.reduce((sum, ret) => sum + Math.pow(ret - mean, 2), 0) / returns.length;
            
            return Math.sqrt(variance) * 100;
        }

        function calculateMA(prices, period) {
            if (prices.length < period) return prices[prices.length - 1];
            
            const slice = prices.slice(-period);
            return slice.reduce((a, b) => a + b, 0) / slice.length;
        }

        function calculatePeriodChange(prices, period) {
            if (prices.length < period) return 0;
            
            const startPrice = prices[prices.length - period];
            const endPrice = prices[prices.length - 1];
            
            return ((endPrice - startPrice) / startPrice) * 100;
        }

        function updateChart(data, ticker) {
            const trace1 = {
                x: data.dates,
                y: data.prices,
                type: 'scatter',
                mode: 'lines',
                name: 'Price',
                line: { color: '#ffffff', width: 3 }
            };

            const trace2 = {
                x: data.dates,
                y: data.volumes,
                type: 'bar',
                name: 'Volume',
                yaxis: 'y2',
                marker: {
                    color: data.prices.map((price, i) => 
                        i === 0 ? 'rgba(0, 255, 0, 0.3)' : 
                        price >= data.prices[i-1] ? 'rgba(0, 255, 0, 0.3)' : 'rgba(255, 0, 0, 0.3)'
                    )
                }
            };

            const layout = {
                title: {
                    text: `${ticker} - Price Chart (${currentPeriod.toUpperCase()})`,
                    font: { color: '#ffffff', size: 18 }
                },
                xaxis: { 
                    title: 'Date',
                    color: '#ffffff',
                    gridcolor: 'rgba(255, 255, 255, 0.2)'
                },
                yaxis: { 
                    title: 'Price ($)',
                    color: '#ffffff',
                    gridcolor: 'rgba(255, 255, 255, 0.2)'
                },
                yaxis2: {
                    title: 'Volume',
                    overlaying: 'y',
                    side: 'right',
                    showticklabels: false
                },
                height: 400,
                plot_bgcolor: 'rgba(0, 0, 0, 0.8)',
                paper_bgcolor: 'rgba(0, 0, 0, 0.5)',
                font: { color: '#ffffff' }
            };

            Plotly.newPlot('chart', [trace1, trace2], layout);
        }

        // Add event listeners to time period buttons
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.time-period-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const period = this.getAttribute('data-period');
                    updateChartPeriod(period);
                });
            });
        });

        function updateChartPeriod(period) {
            currentPeriod = period;
            
            // Update active button
            document.querySelectorAll('.time-period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (currentTicker) {
                // Show loading
                document.getElementById('prediction').innerHTML = '<div class="loading">Updating chart...</div>';
                document.getElementById('analysis').innerHTML = '<div class="loading">Loading analysis...</div>';
                
                // Re-fetch data with new period and update chart immediately
                fetchRealStockData(currentTicker).then(data => {
                    if (data) {
                        currentData = data;
                        updateChart(data, currentTicker);
                        displayRealAnalysis(data, currentTicker);
                    } else {
                        generateDemoChart(currentTicker);
                    }
                });
            }
        }

        // Allow Enter key to search
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchStock();
            }
        });
    </script>
</body>
</html>
